<div class="fullscreen flex flex-col bg-slate-300 relative">
  <div class="md:self-center md:w-1/2 lg:w-1/3 flex-1 flex flex-col md:shadow-2xl">
    <!-- navbar -->

    <div class="bg-blue-900 flex flex-row items-center gap-3 p-3 sticky top-0 md:rounded z-10">
      <div (click)="router.navigate([''])" class="flex flex-row gap-3 items-center cursor-pointer">
        <i class="pi pi-arrow-left text-white font-bold text-xl"></i>
        <p-avatar
          [image]="user().profile.profileImage" 
          size="xlarge" 
          shape="circle"
          class="flex flex-col"
        />
      </div>
      <span class="text-white" (click)="scrollToBottom()">
        {{user().profile.firstName}} {{user().profile.surname}}
      </span>
    </div>

    <!-- all message -->
    
    <app-messages
      [userId]="user()._id"
      [onFetch]="fetchState().running"
      [messages]="fetchState().result"
      [isError]="fetchState().isError"
      (requestResend)="resend($event)"
      class="flex-1 relative overflow-x-auto gap-3 p-6 flex flex-col {{fetchState().isError ? 'center':''}} "
    />

    <!-- text and picture message form -->

    <app-send-message 
      (send)="send($event)"
      [uploading]="uploading"
      [newMessage]="newMessage"
      [isRunning]="sendState().running"
      [isValid]="isValid.test(newMessage.value.value)"
      (upload)="upload($event)"
      class="sticky bottom-0"
    />

    <p-dialog header="Send" [(visible)]="visible" [modal]="true">
      <div class="flex flex-col gap-3">
        <img
          [src]="imageMessage.value.value" 
          alt="Image"
          class="h-72 aspect-square rounded"
        />
        <form [formGroup]="imageMessage" (submit)="sendImage(imageMessage)">
          <p-inputGroup class="flex flex-row">
            <input 
              type="text" 
              pInputText 
              placeholder="Description"
              class="flex-1 px-3 outline-none"
              formControlName="description"
            />
            <button type="submit" pButton icon="pi pi-send">
            </button>
          </p-inputGroup>
        </form>
      </div>
    </p-dialog>
    
  </div> 

  <!--<div id="anchor"></div>-->
</div>
